<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כתיבת פוסט חדש - הכותבים</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-container">
            <div class="site-title">
                <h1 class="main-title">הכותבים</h1>
                <p class="subtitle">ודון קישוט של המילים</p>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-button">דף הבית</a>
                <a href="posts.html" class="nav-button">כל הפוסטים</a>
                <a href="post-editor.html" class="nav-button admin active">כתיבת פוסט חדש</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="admin-panel">
            <h1>יצירת פוסט חדש</h1>
            <form id="postForm" class="post-form">
                <div class="form-group">
                    <label for="title">כותרת:</label>
                    <input type="text" id="title" required class="form-control">
                </div>

                <div class="form-group">
                    <label for="summary">תקציר:</label>
                    <textarea id="summary" class="form-control" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="content">תוכן:</label>
                    <div class="editor-toolbar">
                        <button type="button" onclick="formatText('bold')" class="toolbar-button">B</button>
                        <button type="button" onclick="formatText('italic')" class="toolbar-button">I</button>
                        <button type="button" onclick="formatText('h2')" class="toolbar-button">כותרת</button>
                        <button type="button" onclick="addLink()" class="toolbar-button">קישור</button>
                        <button type="button" onclick="formatText('ul')" class="toolbar-button">•</button>
                    </div>
                    <textarea id="content" class="form-control editor-content" rows="15"></textarea>
                </div>

                <div class="form-group">
                    <label for="tags">תגיות (הפרד בפסיקים):</label>
                    <input type="text" id="tags" class="form-control">
                </div>

                <div class="form-actions">
                    <button type="submit" class="button">פרסם פוסט</button>
                    <button type="button" class="button secondary" onclick="saveDraft()">שמור טיוטה</button>
                </div>
            </form>

            <div id="preview" class="preview-panel"></div>
        </div>
    </main>

    <style>
        .editor-toolbar {
            background: #f5f5f5;
            padding: 0.5rem;
            border-radius: 8px 8px 0 0;
            border: 1px solid #ddd;
            border-bottom: none;
        }

        .toolbar-button {
            background: white;
            border: 1px solid #ddd;
            padding: 5px 10px;
            margin-left: 5px;
            border-radius: 4px;
            cursor: pointer;
        }

        .toolbar-button:hover {
            background: #f0f0f0;
        }

        .editor-content {
            border-radius: 0 0 8px 8px;
            min-height: 300px;
        }

        .preview-panel {
            margin-top: 2rem;
            padding: 2rem;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            background: white;
        }
    </style>

    <script src="load-posts.js"></script>
    <script>
        const blogSystem = new BlogSystem();

        function formatText(style) {
            const textarea = document.getElementById('content');
            const selection = textarea.value.substring(textarea.selectionStart, textarea.selectionEnd);
            let formatted = '';

            switch(style) {
                case 'bold':
                    formatted = `<strong>${selection}</strong>`;
                    break;
                case 'italic':
                    formatted = `<em>${selection}</em>`;
                    break;
                case 'h2':
                    formatted = `<h2>${selection}</h2>`;
                    break;
                case 'ul':
                    formatted = `\n<ul>\n  <li>${selection}</li>\n</ul>`;
                    break;
            }

            insertAtCursor(textarea, formatted);
            updatePreview();
        }

        function addLink() {
            const url = prompt('הכנס את כתובת הקישור:');
            if (url) {
                const textarea = document.getElementById('content');
                const selection = textarea.value.substring(textarea.selectionStart, textarea.selectionEnd);
                const link = `<a href="${url}">${selection || url}</a>`;
                insertAtCursor(textarea, link);
                updatePreview();
            }
        }

        function insertAtCursor(textarea, text) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const before = textarea.value.substring(0, start);
            const after = textarea.value.substring(end);
            textarea.value = before + text + after;
            textarea.focus();
        }

        function updatePreview() {
            const content = document.getElementById('content').value;
            document.getElementById('preview').innerHTML = content;
        }

        document.getElementById('content').addEventListener('input', updatePreview);

        document.getElementById('postForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const postData = {
                title: document.getElementById('title').value,
                summary: document.getElementById('summary').value,
                content: document.getElementById('content').value,
                tags: document.getElementById('tags').value.split(',').map(tag => tag.trim())
            };

            const { post, instructions } = blogSystem.prepareNewPost(postData);
            
            // הצגת ההוראות
            alert(`הפוסט מוכן להעלאה!\n\n${instructions}`);
            
            // מעבר לדף הפוסטים
            if (confirm('האם תרצה לעבור לדף הפוסטים?')) {
                window.location.href = 'posts.html';
            }
        });

        function saveDraft() {
            const draftData = {
                title: document.getElementById('title').value,
                summary: document.getElementById('summary').value,
                content: document.getElementById('content').value,
                tags: document.getElementById('tags').value,
                lastSaved: new Date().toISOString()
            };

            localStorage.setItem('postDraft', JSON.stringify(draftData));
            alert('הטיוטה נשמרה בהצלחה!');
        }

        // טעינת טיוטה אם קיימת
        window.addEventListener('load', function() {
            const savedDraft = localStorage.getItem('postDraft');
            if (savedDraft) {
                const draft = JSON.parse(savedDraft);
                document.getElementById('title').value = draft.title || '';
                document.getElementById('summary').value = draft.summary || '';
                document.getElementById('content').value = draft.content || '';
                document.getElementById('tags').value = draft.tags || '';
                updatePreview();
            }
        });
    </script>
</body>
</html>
